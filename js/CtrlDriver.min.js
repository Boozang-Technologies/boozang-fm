var{assign:A}=Object,_={bd:{'{':'}','[':']','(':')','\'':'\'','"':'"','`':'`'},_tmpValue:0,_curDomItem:null,_curSignedList:[],_updateUIList:[],_cleanList:new Set(),_refershDataList:[],_arrayUIList:[],_afterUpdateFunList:[],_proxyTypes:[Location,Object,Array],_delaySet:function(d,k,v){setTimeout(()=>d[k]=v,10)},_updateObj:function(o,B,v){B.constructor!=Array&&(B=[B]);for(const k of B){o[k]=0;v==void 0?delete o[k]:o[k]=v}},_refreshDom:function(C){if(C){if(C.constructor==String){C=$(C)[0];if(!C)return}let p=C.parentElement,_b=C.previousSibling;p&&(C.remove(),C=_._drawView(C._ctrl,C._data,C._viewDef,p,_b),!_b&&p.firstChild!=C&&C.parentElement.insertBefore(C,C.parentElement.firstChild))}},_refreshData:function(d,k,_c,D){let v=d[k];d[k]=D==void 0?!v:D;setTimeout(()=>{d[k]=v;_c&&setTimeout(()=>_c(),20)},100)},_isProxibleObj:function(o){return o&&!o._isBZProxy&&_._proxyTypes.indexOf(o.constructor)>=0},_mergeData:function(_a,_B){for(var k in _a)_B[k]=_a[k]},_replaceData:function(_A,E){_._mergeData(_A,E);for(var k in E)_A[k]!=E[k]&&(E[k]=void 0)},_createBZArea:function(aA){var o=$(aA).find('#bz-tmp-area');!o.length&&($('<div id=\'bz-tmp-area\'></div>').insertAfter(aA.body),o=$(aA).find('#bz-tmp-area'));return o},_findKeyOuterBlock:function(aB,aC,_C,_d,_e){_d=_d||_.bd;let k,b,c,s;j();aB.push&&(aB=[...aB]);_C&&(aB=aB.push?aB.splice(_C):aB.substring(_C));for(let i=0;i<aB.length;i++){c=aB[i];c=='/'&&aB[i+1]=='>'&&(aB=aB.substring(0,i)+'></'+aB.match(/^<([^ \/>]+)/)[1]+'>'+aB.substring(i+2),c='>');if(c=='\\')b=!b; else if(b)b=0;else{if(!_e&&k=='/'&&c=='/'){j();continue}if(!_e&&!k&&c=='/'&&(!s||s.trim().match(/[\(\[\=\?\:]$/))){k='/';continue} else if(k){k.r==c?k.n?k.n--:j():k.l==c&&k.n++;continue}else _d[c]&&(k={l:c,r:_d[c],n:0,p:{k:c}})}s.push?s.push(c):s+=c;let aD=K(s,c);if(aD){if(aB.pop)return{e:aB.splice(i+1),p:aB.splice(0,i),k:aD};return{p:aB.substring(0,i-aD.length+1),k:aD,e:aB.substring(i+1)}}}function j(){k=0;s=aB.constructor==Array?[]:''}function K(s,c){if(aC.constructor==Function)return aC(s);if(aC.constructor==RegExp){s=s.match(aC);return s?.[0]}return (aC==s||aC==c)&&aC}},_parseViewDef:function(s){let r={s:s.trim()};let aE=[];_D(r.s,aE,[]);aE.length==1&&(aE=aE[0]);return aE;function _D(s,aF,aG){let p=_._findKeyOuterBlock(s,'>');if(p){let d={};aF.push(d);p.p=_E(p.p,d);F(p.p,d);p.e=p.e.trim();if(p.p?.endsWith('/')){p=g(p.e,aF);return _D(p,aF,aG)}d._items=d._items||[];p=g(p.e,d._items);if(p[0]=='/'){let i=0;while (p[0]=='/') {p=p.replace(/^\/[^>]+>/,'');p&&(p=g(p,aF));i&&(aF=aG.shift());i++}return _D(`<${p}`,aF,aG)}aG.unshift(aF);return _D(`<${p}`,d._items,aG)}}function _E(s,d){s=s.substring(1);let p=_._findKeyOuterBlock(s,' ');if(p){d._tag=p.p;return p.e}if(s.endsWith('/')){d._tag=s.substring(0,s.length-1);return'/'}d._tag=s;return''}function F(s,d){s=s.trim();if(!s)return;d._attr=d._attr||{};let p=_._findKeyOuterBlock(s,'=');if(p){p.p=p.p.split(/\s/).map(x=>x);let y=p.p.pop();for(const x of p.p)d._attr[x]=1;let aH=_._findKeyOuterBlock(p.e.trim(),' '),aI;y[0]=='_'?aI=d:['click','dblclick','change','focus','blur','mouseover','mousedown','mouseup','keydown','keyup','keypress'].includes(y)?(d._jqext=d._jqext||{},aI=d._jqext):(aI=d._attr);aH?(aI[y]=h(aH.p,1),F(aH.e,d)):(aI[y]=h(p.e,1))}else for(const x of s.split(/\s/))d._attr[x]=1}function g(s,aJ){s=_._findKeyOuterBlock(s,'<');if(s){s.p=s.p.trim();s.p&&aJ.push({_text:h(s.p)});return s.e}}function h(s,p){if(p&&s.match(/["'\[]/)){eval(`s=${s}`);return s}if(_._isFunction(s)){eval(`s=${s}`);return s}return s}},_execute:function(aK,aL,aM,aN){_doc=aK._document||document;aL=aL||aK._data||{};aM=aM||aK._viewDef;aN=aN||aK._area||(_doc==document?_doc.body:_._createBZArea(_doc));!aK._data&&(aK._data=aL);if(aL==aK._data){aL=_._buildProxy(aL);aK._data=aL} else if(!aL._isBZProxy)throw Error(`Data is not build in binding. ('${JSON.stringify(aL,0,2)}')`);_._initUIBind(aK,aL,aM);var aO=_._drawView(aK,aL,aM,aN);_._curDomItem=null;return aO},_monitorData:function(aP,aQ,aR){if(window.BZ&&BZ._debugger){!_._lastSet&&(_._lastSet={});if(_._lastSet._target!==aP||_._lastSet.name!==aQ)_._lastSet={_target:aP,name:aQ,value:aR,_repeat:0,_repeatValue:0};else{_._lastSet.value!==aR&&_._lastSet._repeatValue++;_._lastSet._repeat++}}},_buildProxy:function(aS,aT,aU){if(!aS)return aS;if(!aS._isBZProxy)return new Proxy(aS, {_parent:aT,_name:aU,get:function(aV,aW){if(aW=='_isBZProxy')return!0;if(aW=='_uiMap'){!this._uiMap&&(this._uiMap={});return this._uiMap}if(aW=='constructor')return aV.constructor;if(aW=='_target')return aV;var aX=aV[aW];!this._uiMap&&(this._uiMap={});_._isProxibleObj(aX)&&(aV[aW]=_._buildProxy(aV[aW],this,aW));if(_._curDomItem){!this._uiMap[aW]&&_._isProxibleObj(aV)&&(!aX||aX.constructor!=Function)&&!(aV.constructor==Array&&aW=='length')&&(this._uiMap[aW]=[]);aX&&aX.constructor==Array&&!aV[aW]._uiMap.splice&&(aV[aW]._uiMap.splice=this._uiMap[aW],aV[aW]._uiMap.push=this._uiMap[aW],aV[aW]._uiMap.unshift=this._uiMap[aW],aV[aW]._uiMap.pop=this._uiMap[aW],aV[aW]._uiMap.shift=this._uiMap[aW]);this._uiMap[aW]&&this._uiMap[aW].constructor==Array&&(aX&&aX.constructor==Function?_._updateArrayUI(this._uiMap[aX.name]):_._bindUI(this._uiMap[aW]))}else aX&&aV.constructor==Array&&aX.constructor==Function&&['splice','push','unshift','pop','shift'].indexOf(aX.name)>=0&&_._updateArrayUI(this._uiMap[aX.name]);return aV[aW]},set:function(aY,aZ,bA){_._monitorData(aY,aZ,bA);var bB=!1,J=(aY[aZ]=bA);_._isProxibleObj(bA)&&(bA=_._buildProxy(bA,this,aZ));!bA||!aY[aZ]||!bA._target||!aY[aZ]._target?bB=aY[aZ]!==bA:bB=bA._target!==aY[aZ]._target;if(bB){var o=this._uiMap?this._uiMap[aZ]:0;o&&!_._updateUIList.includes(o)&&(_._updateUIList.push(o),_._exeUpdateUI());o=_._rootUpdateMap;o&&!_._updateUIList.includes(o)&&(_._updateUIList.push(o),_._exeUpdateUI())}if(aY[aZ]?._uiMap){bA?._isBZProxy&&!bA._uiMap&&delete bA._uiMap[0];if(bA?._uiMap&&bA._uiMap!=aY[aZ]._uiMap)for(var k in aY[aZ]._uiMap){var G=bA._uiMap[k],H=aY[aZ]._uiMap[k];if(G&&G!=H)for(var i=0;i<H.length;i++)!G.includes(H[i])&&G.push(H[i]);else bA._uiMap[k]=aY[aZ]._uiMap[k];_._cleanList.add(bA._uiMap[k])}}bA==void 0&&this._uiMap&&delete this._uiMap[aZ];if(aY.constructor==Array&&aZ=='length'&&!J)return!0;if(aY.constructor==Array&&(parseInt(aZ)||!parseInt(aZ))&&!J)return!0;return J}});return aS},_updateArrayUI:function(bC){if(bC){_._arrayUIList.indexOf(bC)<0&&_._arrayUIList.push(bC);_._arrayUITimeout&&clearTimeout(_._arrayUITimeout);_._arrayUITimeout=setTimeout('_CtrlDriver._updateArrayUI()');return}var bD=Date.now();_._inUpdateArrayUIList=!0;while (_._arrayUIList.length) {var u=_._arrayUIList.shift();_._updateDataUI(u,bD)}_._inUpdateArrayUIList=!1},_updateDataUI:function(bE,bF){if(!bE)return;for(var i=0;i<bE.length;i++){var u=bE[i];if(i){let bG=bE[i-1];if(u._dom==bG._dom&&u._attr==bG._attr&&u._group==bG._group)continue}if($(u._dom.ownerDocument).find(u._dom).length){if(bF&&u._time>bF)continue;try {!u._dom._data&&u._dom._viewDef._data&&(u._dom._data=_._retrieveResult(u._dom._viewDef._data,{},{}));_._curSignedList=[];_._updateCount++;_._curDomItem=u;if(u._attr=='_if')u._dom._viewDef._if&&_._updateIf(u); else if(u._attr=='[\'load\']')u._dom._viewDef._load?_._loadContent(u):bE.splice(i,1); else if(u._attr=='[\'html\']')_._updateHtml(u);else u._attr=='[\'text\']'?u._dom._viewDef._text&&_._updateText(u):u._attr=='[\'value\']'?_._updateValue(u):u._attr=='rebuild'?_._updateRebuild(u):u._attr=='repeat'?_._updateRepeat(u):_._updateAttr(u)} catch (e) {_._handleError(e)}}else{bE.splice(i,1);i--}}},_handleError:function(bH){window._inDebugging&&console.log(bH.stack)},_initUIBind:function(bI,bJ,bK,bL){_._curSignedList=[];var bM=bI._document||document;_._curDomItem=bM.createTextNode('');_._curDomItem._ctrl=bI;_._curDomItem._data=bJ;_._curDomItem._viewDef=bK;_._curDomItem._hookers=bL||[];_._curDomItem={_dom:_._curDomItem,_attr:'_if'}},_initUIBindByDom:function(bN){_._initUIBind(bN._ctrl,bN._data,bN._viewDef,bN._hookers)},_changeBindAttr:function(bO){_._curDomItem={_dom:_._curDomItem._dom,_attr:bO}},_replaceBindDom:function(bP,bQ,bR){bP&&(bP._ctrl=_._curDomItem._dom._ctrl,bP._data=_._curDomItem._dom._data,bP._viewDef=_._curDomItem._dom._viewDef,bP._hookers=_._curDomItem._dom._hookers,_._curDomItem._dom=bP);bQ&&(_._curDomItem._attr=bQ);for(var i=0;i<_._curSignedList.length;i++){var o=_._curSignedList[i];bP&&(o._dom=bP);bQ&&(o._attr=bQ)}bR&&(_._curSignedList=[])},_retrieveResult:function(bS,bT,bU,bV){var bW=null;try {if(bS&&bS.constructor==Function)bW=bS(bT,bU,bV); else if(bS&&(bS.constructor==Array||bS.constructor==Object))bW=bS; else if(bS&&bS.constructor!=String)bW=bS;else try {bS&&(bS.includes('.')||(bS.endsWith('\'')&&bS[0]=='\''))&&!bS.endsWith('.')?eval(`_result=${bS}`):bW=bS} catch (e) {bW=bS;e.message&&(e.message.includes('null')||e.message.includes('undefined'))&&bS.constructor==String&&(bW='')}} catch (bX) {bW='';console.log(bX.stack);!bX.message||(!bX.message.endsWith('of null')&&!bX.message.endsWith('of undefined'))&&console.error(bX)}return bW},_bindUI:function(bY){if(!bY||bY.constructor==Function)return;for(var i=0;i<bY.length;i++){var u=bY[i];if(u._dom==_._curDomItem._dom&&u._attr==_._curDomItem._attr){if(u._attr=='repeat'&&u._viewDef._dataRepeat!==_._curDomItem._viewDef._dataRepeat)continue;return}}!bY.includes(_._curDomItem)&&(_._curDomItem._time=Date.now(),bY.push(_._curDomItem),_._curSignedList.push(_._curDomItem),_._cleanList.add(bY),_._exeCleanList())},_cleanDom:function(bZ){$(bZ).remove();if(bZ.children)for(var i=0;i<bZ.children.length;i++)_._cleanDom(bZ.children[i])},_isRemovedElement:function(e){while (e.parentElement) {if(['BODY','HTML'].includes(e.tagName))return;e=e.parentElement}return 1},_cleanData:function(cA,cB){if(cB){if(cA.constructor==Array)if($.isNumeric(cB))cA.splice(cB,1);else for(const x of cA){x[cB]=0;delete x[cB]}else{cA[cB]=0;delete cA[cB]}return}if(cA.constructor==Array)while (cA.length)cA.pop();else for(var k in cA){cA[k]=null;delete cA[k]}},_exeCleanList:function(cC){if(!cC){_._curCleanListTimeout&&clearTimeout(_._curCleanListTimeout);_._curCleanListTimeout=setTimeout(function(){_._exeCleanList(1)},1);return}var cD=Date.now(),cE=0,cF=0,cG=0;for(var _f of _._cleanList){var _g=[],_h=[];cG++;for(var i=0;i<_f.length;i++){var u=_f[i],_k=0;cF++;if((!u._dom.parentElement||!u._dom.ownerDocument||!u._dom.ownerDocument.defaultView||(!u._dom.parentElement.getBoundingClientRect().width&&_._isRemovedElement(u._dom.parentElement)))&&u._time<cD)_k=_f.splice(i--,1); else if(_g.indexOf(u._dom)<0){_h.push([u._attr]);_g.push(u._dom)}else{var l=_g.indexOf(u._dom);u._attr=='repeat'||_h[l].indexOf(u._attr)<0?_h[l].push(u._attr):_k=_f.splice(i--,1)}_k&&(_._cleanDom(_k[0]),cE++)}}_._cleanList.clear()},_assignFunForAfterUpdate:function(f){!_._afterUpdateFunList.includes(f)&&_._afterUpdateFunList.push(f);clearTimeout(_._assignFunTimer);_._assignFunTimer=setTimeout(()=>!_._updateUIList.length&&_._exeAfterUpdate(),20)},_exeAfterUpdate:function(){while (_._afterUpdateFunList.length)_._afterUpdateFunList.shift()()},_exeUpdateUI:function(cH){if(!cH){_._curUIUpdateTimeout&&clearTimeout(_._curUIUpdateTimeout);_._curUIUpdateTimeout=setTimeout(function(){_._exeUpdateUI(1)},1);return}_._updateCount=0;var cI=[];while (_._updateUIList.length) {var cJ=_._updateUIList.shift();for(var i=0;i<cJ.length;i++){var u=cJ[i];cI.indexOf(u)<0&&cI.push(u)}_._cleanList.add(cJ)}_._updateDataUI(cI,Date.now());_._exeCleanList();_._curDomItem=null;_._curSignedList=[];!_._updateUIList.length&&_._exeAfterUpdate()},_updateValue:function(u){var cK=u._dom._data,cL=u._dom._viewDef,cM=null;try {cL._dataModel.constructor==Function?eval('_value='+cL._dataModel(cK)):eval('_value='+cL._dataModel);cM==void 0||cM==null?cM='':cM&&![Object,Array].includes(cM.constructor)&&(cM=`${cM}`);if(u._dom.contenteditable){let cO=$(u._dom.ownerDocument).find(':focus')[0];cO&&(cO!=u._dom&&!$(u._dom).find(cO)[0])&&u._dom._refresh&&u._dom._refresh()} else if(u._dom.type&&u._dom.type=='checkbox')u._dom.checked=(cM&&u._dom.value=='on')||(cM==u._dom.value); else if(u._dom.type&&u._dom.type=='radio')u._dom.checked=cM==(u._dom._orgValue||u._dom.value); else if(u._dom.tagName=='SELECT'){var cN=u._dom.options;for(var i=0;i<cN.length;i++){var p=cN[i];if(p._orgValue==cM||p.value==cM){u._dom.value=p.value;return}}}else{var _H=$(u._dom.ownerDocument).find('*:focus')[0]==u._dom;!_H?(u._dom._viewDef._formatGet&&(cM=u._dom._viewDef._formatGet(cM,u._dom),cM==void 0&&(cM='')),u._dom.value=cM):(_._inTyping=!0,!u._dom._bzTypingBlur&&(u._dom._bzTypingBlur=!0,$(u._dom).blur(function(){this._bzTypingBlur=!1;_._inTyping=!1})))}} catch (e) {_._handleError(e)}},_updateAttr:function(u){var cP=u._dom._viewDef,cQ=_._retrieveResult('',u._dom._data,u._dom._ctrl,u._dom);if(!cP._attr)return;eval('_value=_viewDef'+u._attr);cQ==void 0&&(cQ='');if(u._attr=='[\'_attr\'][\'style\']')if(cQ){cQ=cQ.split(';');for(var i=0;i<cQ.length;i++){var r=cQ[i].split(':');r.length>1&&u._dom.style.setProperty(r[0],r[1].replace(' !important',''),r[1]?.includes('!important')?'important':'')}} else if(u._attr=='[\'_attr\'][\'class\']')u._dom.className=cQ;else{var _F=u._attr.split('][\'')[1].split('\'')[0];['disabled','readonly','checked','selected','draggable','droppable','enable'].includes(_F)&&(cQ=!!cQ);if(_F=='value')u._dom.value=cQ;else{u._dom[_F]=cQ;$(u._dom).attr(_F,cQ);_F=='enable'||_F=='disabled'&&_._attachEnable(u._dom)}}},_loadContent:function(u){var cR=_._curDomItem._dom,cS=cR._viewDef._load;u?(_._curDomItem=u,cR=u._dom):(_._curDomItem={_dom:cR,_attr:'[\'load\']'});if(!cS)return;cS.constructor==Function||cS.constructor==String&&(cS=_._retrieveResult(cS,cR._data,cR._ctrl));cS.constructor==String&&(cS={url:cS,dataType:'text/plain'});if(_._equalObj(cR._viewDef._lastLoad,cS)&&!cS._noCache){if(cR._viewDef._html)return _._updateHtml(u);if(cR._viewDef._text)return _._updateText(u);return cR}cR._viewDef._lastLoad=cS;$.ajax(cS).fail(e=>e.message?alert('Load page error: '+e.message):e.responseText&&cT(e)).done(e=>cT(e));function cT(d){d.responseText&&(d=d.responseText);cS._handler&&(d=cS._handler(d));var cU=null,cV=cR._ctrl._document||document,cW=cV==document?cV.body:_._createBZArea(cV);try {if(cR.tagName=='SCRIPT')eval(d);else{eval(`dd=${d}`);!cR._viewDef._noCache?(delete cR._viewDef._load,A(cR._viewDef,cU)):(cR._viewDef=cU);cU=_._drawView(cR._ctrl,cR._data,cR._viewDef,cW,cR)}} catch {var cU=$(d)[0];!cU&&(cU=cV.createTextNode(d))}if(cU){cU._ctrl=cR._ctrl;cU._data=cR._data;cU._viewDef=cR._viewDef;if(cU._viewDef._load){cU.outerHTML?cU._viewDef._html=d:cU._viewDef._text=d;cR._resultDom&&_._cleanDom(cR._resultDom);$(cU).insertAfter(cR);cR._resultDom=cU;return cU}$(cR).replaceWith(cU)}}_._attachEnable(cR);return cR},_updateHtml:function(u){u?_._curDomItem=u:_._curDomItem={_dom:_._curDomItem._dom,_attr:'[\'html\']'};var cX=_._curDomItem._dom._ctrl._document||document,cY=_._curDomItem._dom,cZ=_._retrieveResult(cY._viewDef._html,cY._data,cY._ctrl),dA=null;if(cZ!==null&&cZ!==void 0){cZ.constructor==String&&(cZ=cZ.trim());cZ.constructor==String&&cZ[0]=='<'&&cZ[cZ.length-1]=='>'?dA=$(cZ)[0]:cZ.nodeType&&(dA=cZ);!dA&&(dA=cX.createTextNode(cZ))}else dA=cX.createTextNode('');u&&$(u._dom).replaceWith(dA);_._replaceBindDom(dA,'[\'html\']',!0);return dA},_updateText:function(u){var dB=_._curDomItem._dom,dC=_._retrieveResult(dB._viewDef._text,dB._data,dB._ctrl,dB);u?_._curDomItem=u:_._curDomItem={_dom:dB,_attr:'[\'text\']'};dC==null||dC==void 0&&(dC='');dB.textContent=dC;dB.innerHTML&&(dB.innerHTML=dB.innerHTML.replace(/\&(amp\;)([\d\#a-z]+\;)/g,'&$2'));_._replaceBindDom(null,'[\'text\']',!0);return dB},_updateRebuild:function(u){var dD=_._drawView(u._dom._ctrl,u._dom._data,u._dom._viewDef);if(dD){dD.constructor!=Array&&(dD=[dD]);for(var i=0;i<dD.length;i++)$(dD[i]).insertAfter(u._dom)}_._cleanDom(u._dom)},_updateIf:function(u){u&&_._initUIBindByDom(u._dom);var dE=_._curDomItem._dom,dF=_._retrieveResult(dE._viewDef._if,dE._data,dE._ctrl,dE);if(!dF||(dF.constructor==String&&dF==dE._viewDef._if)){if(u&&u._dom.nodeType==dE.nodeType&&!u._dom.textContent){_._curDomItem._dom=u._dom;return}if(!u)return null;var dG=_._curDomItem._dom;(dE._viewDef._animation?._hide||_._animationHideAll)&&(!dE._viewDef._animation||dE._viewDef._animation._hide!='none')?dE._viewDef._animation?._hide?dE._viewDef._animation._hide(u._dom,function(){dI(u,dG)}):_._animationHideAll(u._dom,function(){dI(u,dG)}):dI(u,dG);return}if(u&&(u._dom.nodeType!=dE.nodeType||u._dom.textContent))return;if(!u)return _._curDomItem;if(u._dom._viewDef._dataRepeat){_._repeatData(u._dom._ctrl,u._dom._data,u._dom._viewDef,u._dom.parentElement,u._dom);_._cleanDom(u._dom)}else{u._dom._viewDef._tag?dE=_._updateDom(u):u._dom._viewDef._load?dE=_._loadContent(u):u._dom._viewDef._html?dE=_._updateHtml(u):u._dom._viewDef._text&&(dE=_._updateText(u));var dH=(dE._viewDef._animation?._show||_._animationShowAll)&&(!dE._viewDef._animation||dE._viewDef._animation._show!='none');dH&&dE.tagName&&(dE.style.display='none');$(u._dom).replaceWith(dE);dE.parentElement&&_._attachEnable(dE.parentElement,dE);dH&&dE.tagName&&(dE._viewDef._animation?._show?dE._viewDef._animation._show(dE):_._animationShowAll&&_._animationShowAll(dE))}function dI(u,dJ){$(u._dom).replaceWith(dJ);_._cleanDom(u._dom);u._dom=dJ}},_buildDom:function(u){u=u._dom;var dK=u._data,dL=_._retrieveResult(u._viewDef._tag,u._data,u._ctrl),dM=_._fillAttrs(u._viewDef,dK,u._ctrl),dN=$(`<${dL} `)[0];u._viewDef._data&&(u._data=dK=_._retrieveResult(u._viewDef._data,u._data,u._ctrl)||dK);dM==null||(dM&&(dM.constructor==Object||dM.constructor==Array))?_html+=dM._html:_html+=dM;['INPUT','IMG','BR','HR'].indexOf(dL.toUpperCase())>=0?_html+='/>':_html+=`></${dL}>`;dM==null||(dM&&(dM.constructor==Object||dM.constructor==Array))&&(dN._orgValue=dM._orgValue);u._viewDef._after&&setTimeout(function(){u._viewDef._after(dN,dK)},u._viewDef._animation?1010:10);return dN},_updateDom:function(u,dO){var dP=_._buildDom(u),dQ=null;_._replaceBindDom(dP,null,!0);_._bindJqExt(dP._viewDef._jqext,dP,dO);_._setBZCommonBehavior(dP);dP._viewDef.id?dQ=dP._viewDef.id:dP._viewDef._attr?.id&&(dQ=dP._viewDef._attr.id);dQ&&(!dP._ctrl._comps&&(dP._ctrl._comps={}),dP._ctrl._comps[dQ]=dP);if(dP._viewDef._items){var dR=dP._viewDef._items;dR.constructor==String||dR.constructor==Function&&(dR=_._retrieveResult(dR,dP._data,dP._ctrl,dP));for(var i=0;dR&&i<dR.length;i++){var r=dR[i];r&&(r.constructor==String&&(r=_._parseViewDef(r)),_._drawView(dP._ctrl,dP._data,r,dP))}}dP._viewDef._load?dP=_._loadContent():dP._viewDef._html?$(dP).append(_._updateHtml()):dP._viewDef._text&&$(dP).append(_._updateText());if(dP._viewDef._required){var dS=_._retrieveResult(dP._viewDef._required,dP._data,dP._ctrl);dS&&(!$(dP).val()&&$(dP).addClass('required'),$(dP).on('input',function(){!this.value?$(this).addClass('required'):$(this).removeClass('required')}))}if(dP._viewDef._dataModel){var I=_._retrieveResult(dP._viewDef._tag,dP._data,dP._ctrl);if(['INPUT','SELECT','TEXTAREA'].includes(I.toUpperCase())||dP._viewDef._attr?.contenteditable){if(dP._viewDef._attr?.type)var _j=_._retrieveResult(dP._viewDef._attr.type,dP._data,dP._ctrl),_K='change',dO=dP._data;else _j='text';['INPUT','TEXTAREA'].indexOf(dP.tagName)>=0&&_j!='checkbox'&&_j!='radio'&&(_K='input');_K=dP._viewDef._updateEvent||_K;$(dP).on('change',function(){this._bzUpdate=1});$(dP).on(_K,function(){let dT=this;try {_._typingBox=dT;var dU=dT._data,dV=dT._viewDef._dataModel;dV.constructor==Function&&(dV=dV(dU));if(dT.type=='checkbox')dT.checked?eval(`${dV}=_this._orgValue||_this.value`):eval(`${dV}=null`);else{var dW=null;if(dT._viewDef._dataType==Number){dW=parseFloat(dT.value);!dW&&(dW=0)}else dW=dT.value;dT.tagName=='SELECT'?dT.selectedOptions[0]._orgValue&&(dW=dT.selectedOptions[0]._orgValue):dT.type=='radio'&&(dW=dT._orgValue||dT.value);dT._viewDef._formatSet&&(dW=dT._viewDef._formatSet(dW,dU,dT));eval(`${dV}=_value`)}} catch {}});$(dP).on(_K=='input'?'change':_K,function(){let dX=this,dY=this;_._chkIgnoreUpdate(dX,function(){while (dX?._viewDef&&!dX._viewDef._update) {if(dX._viewDef._noUpdate||dX.tagName=='BODY')return;dX=dX.parentElement}if(!dY._bzUpdate)return;dY._bzUpdate=0;dX?._viewDef&&setTimeout(function(){var dZ=dX._viewDef._update;dZ.constructor==Function?dZ(dO,dP,dX):eval(dZ)},100)})});$(dP).on('keyup',function(){this._bzOldValue=this._bzOldValue==void 0&&this.value});$(dP).on('blur',function(){this._bzOldValue=void 0;['INPUT','TEXTAREA'].includes(this.tagName)&&(this.value=this.value.trim());_._typingBox=null});_._curDomItem={_dom:dP,_attr:'[\'value\']'};try {dP._viewDef._dataModel.constructor==Function?eval('_value='+dP._viewDef._dataModel(dO)):eval('_value='+dP._viewDef._dataModel);if(_j=='checkbox')dP.checked=dP.value=='on'?!!_value:dP.value==_value; else if(_j=='radio')dP.checked=(dP._orgValue||dP.value)==(_value||(!_value?'0':''));else{dP._viewDef._formatGet&&(_value=dP._viewDef._formatGet(_value,dO,dP));$(dP).val(_value);if(_value==null||(_value&&(_value.constructor==Object||_value.constructor==Array))){dP._orgValue=_value;if(dP.tagName=='SELECT')for(var i=0;i<dP.options.length;i++){var L=dP.options[i];if(L._orgValue==_value||(L._orgValue&&_value&&dP._viewDef._key&&L._orgValue[dP._viewDef._key]==_value[dP._viewDef._key])){L.selected=!0;break}}}}} catch (e) {console.log('BZ-LOG: '+dP._viewDef._dataModel);_._handleError(e)}}else{_._curDomItem={_dom:dP,_attr:'rebuild'};try {var dO=dP._data;eval(dP._viewDef._dataModel)} catch (e) {_._handleError(e)}}}if(dP._viewDef._focus){var M=!_._inTyping&&_._retrieveResult(dP._viewDef._focus,dP._data,dP._ctrl);M&&setTimeout(function(){if(!_._inTyping){$(dP).focus();if(dP._viewDef._select)$(dP).select()}},10)}_._curSignedList=[];_._attachEnable(dP);return dP},_triggerUpdateData:function(eA,eB,d,eC){eB=eB||eA;d=d||eB._data;eA._viewDef&&(eA._viewDef._update?eA._viewDef._update.constructor==Function?eA._viewDef._update(d,eB,eA,eC):eval(eA._viewDef._update):eA.parentElement&&_._triggerUpdateData(eA.parentElement,eB,d,eC))},_chkIgnoreUpdate:function(eD,eE){if(eD._viewDef._ignoreUpdate){let eF=$(eD._viewDef._ignoreUpdate)[0];if(eF&&eF.getBoundingClientRect().width)return} else if(eD._viewDef._cancelUpdate)return;eE()},_updateRepeat:function(u){var eG=u._supData;_._curDomItem=u;eG=_._retrieveResult(u._group,eG,u._ctrl);if(eG&&eG.constructor==Number){eG=Array(eG).fill(0);_._updateRepeatInArray(u,eG)}else eG&&eG.constructor==Array?_._updateRepeatInArray(u,eG):_._updateRepeatInObject(u,eG);_._attachEnable(u._dom)},_updateRepeatInArray:function(u,eH){var eI=0,_l=_._clone(u._viewDef);var eJ=0,eK=0;for(var i=0;i<u._dom.childNodes.length;i++){var o=u._dom.childNodes[i];if(o._data&&o._data._group==u._group&&o._data._supData==u._supData){if(!eK){eK=eJ=$('<div></div>').insertBefore(o)[0];continue}if(!$.isNumeric(o._data._idx)){_._cleanDom(o);i--;continue}o._data._idx=eI;if(!eH||eI>=eH.length){_._cleanDom(o);i--} else if(o._data._item!=eH[eI]){var d=o._data._item,_i=eH[eI];try {if(_._typingBox&&$(o).find(_._typingBox).length&&JSON.stringify(d)==JSON.stringify(eH[eI]))return} catch {}if(![Object,Array].includes(o._data._item)){o._data._item=_i;var _J=_._drawView(o._ctrl,o._data,o._viewDef);$(_J).insertBefore(o);_._cleanDom(o);eJ=_J} else if(eH.includes(d)){var eL=_._simpleClone(o._data),_J=_._drawView(o._ctrl,eL,o._viewDef);eL._item=_i;$(_J).insertBefore(o);eJ=_J}else{_._cleanDom(o);i--;continue}} else if(o._data._idx!=o._data._key){o._data._key=o._data._idx;var _J=_._drawView(o._ctrl,o._data,o._viewDef);$(_J).insertBefore(o);eJ=_J;_._cleanDom(o)}else eJ=o;eI++} else if(eI)break}eJ!=eK&&(_._cleanDom(eK),eK=0);delete _l._dataRepeat;let _m=O(u._dom);for(var n=eI;eH&&n<eH.length;n++){var _J=_._drawView(u._ctrl,{_item:eH[n], _group:u._group, _supData:u._supData, _idx:n, _key:n},_l);if(eJ){$(_J).insertAfter(eJ);eJ==eK&&(_._cleanDom(eJ),eK=0)}else _m?$(_J).insertBefore(_m):$(u._dom).append(_J);eJ=_J}eJ==eK&&eK&&_._cleanDom(eJ);function O(d){for(let o of d.children)if(o._viewDef?._endItem)return o}},_updateRepeatInObject:function(u,eM){eM&&eM.constructor==String?eM=[eM]:eM&&eM.constructor==Number&&(eM=Array(eM).fill(0));var eN=_._clone(u._viewDef),eO=0,eP='append',eQ=null;delete eN._dataRepeat;while (u._dom.childNodes.length>eO) {var o=u._dom.childNodes[eO],eR=!1;try {eR=JSON.stringify(o._viewDef)==JSON.stringify(eN)} catch {}if(eR)_._cleanDom(o);else{if(eO){eQ=o;eP='insertBefore';break}eO++}}for(var n in eM){var eS=_._drawView(u._ctrl,{_item:eM[n], _group:u._group, _supData:u._supData, _idx:n, _key:n},eN);eP=='append'?$(u._dom).append(eS):$(eS).insertBefore(eQ)}},_repeatData:function(eT,eU,eV,eW,eX){_._curDomItem={_dom:eW,_attr:'repeat',_time:Date.now(),_group:eV._dataRepeat,_supData:eU,_ctrl:eT,_viewDef:eV};var eY=_._retrieveResult(eV._dataRepeat,eU,eT)||[],_G=[];if(eY){eY.constructor==Number?eY=Array(eY).fill(0):eY.constructor==String&&(eY=[eY]);var eZ=_._clone(eV);delete eZ._dataRepeat;for(var k in eY){$.isNumeric(k)&&(k=parseInt(k));var o={_item:eY[k],_group:eV._dataRepeat,_supData:eU,_idx:k,_key:k,_groupValue:eY};eY.constructor==Array&&(o._size=eY.length);_G.push(_._drawView(eT,o,eZ,eW,eX))}_._curDomItem={_dom:eW,_attr:'repeat',_time:Date.now(),_group:eV._dataRepeat,_supData:eU,_ctrl:eT,_viewDef:eV}}return _G},_drawView:function(fA,fB,fC,fD,fE){fC._data&&(fB=_._retrieveResult(fC._data,fB,fA));_._initUIBind(fA,fB,fC);if(fC._if!==void 0&&!_._updateIf()){fE?$(_._curDomItem._dom).insertAfter(fE):$(fD).append(_._curDomItem._dom);return}if(fC._dataRepeat)return _._repeatData(fA,fB,fC,fD);var fF=null;fC._tag?fF=_._updateDom(_._curDomItem,fB):fC._load?fF=_._loadContent():fC._html?fF=_._updateHtml():fC._text&&(fF=_._updateText());fC._dragOrder&&_._setDragOrder(fF,fC._dragOrder);fE?$(fF).insertAfter(fE):fD&&($(fD).append(fF),_._attachEnable(fD,fF));return fF},_attachEnable:function(fG,fH,fI,fJ){if(fG._viewDef&&((fI!==void 0||fJ!==void 0)||fG._viewDef._attr?.enable||$(fG).attr('enable'))){fI==void 0&&fJ==void 0&&(fI=$(fG).attr('enable'),fJ=$(fG).attr('disabled'));fI=!!(fJ?0:fI);if(fH)fH.tagName&&fK(fH,fI,fJ);else for(let o of fG.children)fK(o,fI,fJ)}function fK(o,fL,fM){o._viewDef&&!$(o).attr('disabled')||o._viewDef._attr?.enable||$(o).attr('enable')==fL&&($(o).attr('enable',fL),_._attachEnable(o,0,fL,fM))}},_setDragOrder:function(fN,fO,fP){fP=fP||0;let p=fO._getBox?fO._getBox(fN):fN.parentElement;if(!p){if(fP>100)return;return setTimeout(()=>_._setDragOrder(fN,fO,fP+1),10)}p._dragOrder?fO=p._dragOrder:p._dragOrder=fO;$(fN).css({cursor:'move'});fN.droppable=!0;fN.draggable=!0;fN.ondragover=function(e){fO._if&&!fO._if();if(fO._curElement){e.preventDefault();let fT=fO._curElement.parentElement.children;fS(fT[fT.length-1]);fO._curOver=this;if(this!=fO._curElement){for(o of fT){if(o==this){this._insert='top';break}if(o==fO._curElement){this._insert='bottom';break}}fS(this,this._insert)}}};fN.ondragstart=function(){fO._if&&!fO._if();fO._curElement=this;fO._curItem=fR(this);!p.droppable&&(p.droppable=!0,p.ondragend=()=>{if(fO._curElement){let fU=fQ();let fV=fU.indexOf(fO._curItem);if(fV<fU.length-1){fU.splice(fV,1);fU.push(fO._curItem);fO._after&&fO._after()}}},p.ondragover=e=>{if(fO._curElement&&!fO._curOver){e.preventDefault();let fW=fO._curElement.parentElement.children;fS(fW[fW.length-1],'bottom')}})};fN.ondragend=function(e){fO._if&&!fO._if();console.log('dom - ondragend');let fX=fQ();let fY=fO._curItem;if(!fO._curOver)return;let fZ=fR(fO._curOver);e.preventDefault();fO._curElement=0;if(fY==fZ){fS(this);return}let gA=fX.indexOf(fY);fX.splice(gA,1);gA=fX.indexOf(fZ);fO._curOver._insert=='top'?fX.splice(gA,0,fY):fX.splice(gA+1,0,fY);if(fX?.[0]&&$.isNumeric(fX[0].idx))for(const[i,x] of fX.entries())x.idx=i;fS(this);fO._curElement=0;fO._after&&fO._after()};fN.ondragleave=function(){fS(this)};function fQ(){return fO._getListData.constructor==Function?fO._getListData():fO._getListData}function fR(o){return fO._getItemData?fO._getItemData():o._data._item}function fS(o,t){!o._topBorder&&(o._topBorder=$(o).css('border-top'),o._bottomBorder=$(o).css('border-bottom'));$(o).css({'border-top':o._topBorder,'border-bottom':o._bottomBorder});fO._curOver=0;if(t){fO._curOver=o;let d={};d[`border-${t}`]='2px dotted var(--active-color)';$(o).css(d)}}},_fillAttrs:function(gB,gC,gD){var gE='',gF=null;if(gB._attr){for(var k in gB._attr){var m=k.match(/^on[a-z]+/),v=gB._attr[k];if(!m||m[0]!=k||v.constructor!==String){_._curDomItem={_dom:_._curDomItem._dom,_attr:`['_attr']['${k}']`};v=_._retrieveResult(v,gC,gD);if(v==void 0)continue;v==null&&(v='');if(['disabled','readonly','required','selected','checked','draggable','droppable','enable'].indexOf(k)>=0){v&&(gE+=` ${k}="true"`);continue}}v==null||(v&&(v.constructor==Array||v.constructor==Object))&&(gF=v,v=_._tmpValue++);v.includes?!v.includes('"')?v=`"${v}"`:!v.includes('\'')?v=`'${v}'`:v=`"${v.replace(/"/g,'&quot;')}"`:v=`"${v}"`;gE+=' '+k+'='+v}var _I=_._retrieveResult(gB._tag,gC,gD);_I.toLowerCase()=='input'&&!gB._attr.type&&(gE+=' type=\"text\"')}if(gF)return{_orgValue:gF,_html:gE};return gE},_bindJqExt:function(gG,gH){if(gG){gG.constructor==String&&(gG=eval(gG));gH=$(gH);for(var k in gG){if(!gG[k])continue;gG[k].constructor==String&&eval('_jqext[k]='+gG[k]);$.isArray(gG[k])?gH[k](gG[k][0],gG[k][1]):['BUTTON','INPUT','TEXTAREA','SELECT'].includes(gH[0].tagName)&&['click','mousedown','dbclick'].includes(k)?(gH[0][`bzEvent${k}`]=gG[k],gH[k](function(a,b,c){if($(this.ownerDocument).find('[disabled]').find(this).length&&!$(this).attr('enable')){a.stopPropagation();a.preventDefault();return}this['bzEvent'+a.type](a,b,c)})):(gH[k](gG[k]))}}},_isFunction:function(s){if(s&&s.constructor==String){s=s.trim();return s.match(/^\(?(function|\([^\)]*\) *=> *)/)}},_simpleClone:function(o){if(o){let n={};if(o.constructor==Array)n=[];else{if(o.cloneNode)return o.cloneNode();if(o.constructor!=Object)return o}for(var k in o)n[k]=o[k];return n}return o},_sign:/[^\w\$À-Üà-ÿŒœ\u4E00-\u9FCC\-]+/,_setBZCommonBehavior:function(){},_cleanFromData:function(gI){var gJ=0,gK=0;if(gI?._uiMap)for(var k in gI._uiMap){var gL=gI._uiMap[k],gM=_._cleanFromData(gI[k]);for(var i=0;i<gL.length;i++){var u=gL[i];gJ++;!u._dom||!u._dom.parentElement&&(gL.splice(i,1),gK++,i--)}gJ+=gM._count;gK+=gM._clean}return{_count:gJ,_clean:gK}},_clone:function(o){if($.type(o)=='array')return $.extend(!0,[],o);if($.type(o)=='object')return $.extend(!0,{},o);return o},_equalObj:function(gN,gO){if(gN==gO)return 1;if(!gN||!gO)return 0;gN=JSON.stringify(gN);gO=JSON.stringify(gO);if(gN==gO)return 1;if(gN.constructor!==String||gO.constructor!==String||gN.length!=gO.length)return 0;gN=JSON.parse(gN);gO=JSON.parse(gO);return this._sortJson(gN)==this._sortJson(gO)},_sortJson:function(d,gP,gQ){!gQ&&(gQ='');var gR='';if(d&&d.constructor==Object){var gS=[];for(var k in d){if(d[k]==void 0||(gP&&!d[k]&&d[k]&&d[k]!==!1))continue;gS.push(k)}gS.sort();gR=`${gQ}{
`;for(var i=0;i<gS.length;i++){k=gS[i];gR+=gQ+'  \"'+k+'\":'+this._sortJson(d[k],gP,`${gQ}  `);i<gS.length-1?gR+=',\n':gR+='\n'}gR+=`${gQ}}`} else if(d&&d.constructor==Array){gR=`${gQ}[
`;for(var k in d){gR+=this._sortJson(d[k],gP,`${gQ} `);k<d.length-1?gR+=',\n':gR+='\n'}gR+=`${gQ}]`}else gR=JSON.stringify(d);return gR},_setupKeyInput:function(gT){gT=gT||document;$(gT).ready(function(){$(gT.body).on('keydown','.bz-key-input',function(){let m=_Util._matchAllSign;event.key&&m.test(event.key)&&event.preventDefault()});$(gT.body).on('keyup','.bz-key-input',function(){!this._chInput&&this.value.match(_Util._matchAllSign)&&(this.value=this.value.replace(_Util._matchAllSign,''))});$(gT.body).on('compositionstart','.bz-key-input',function(){this._chInput=1});$(gT.body).on('compositionend','.bz-key-input',function(){this._chInput=0;this.value=this.value.replace(_Util._matchAllSign,'')});$(gT.body).on('keydown','.bz-name-input',function(){let m=/[\w\.-]/i;!m.test(event.key)&&event.preventDefault()});$(gT.body).on('keyup','.bz-name-input',function(){this.value=this.value.replace(/[^\w\.-]/ig,'')});$(gT.body).on('keyup','.bz-name-input',function(){this.value=this.value.replace(/[^\w\.-]/ig,'')});$(gT.body).on('focus','input,select,textarea,[contenteditable]',function(){if($(this).attr('enable'))return;$(gT).find('[disabled]').find(this).length&&this.blur()});$(gT.body).on('mousedown','INPUT,SELECT,TEXTAREA,BUTTON,LABEL',function(e){if($(gT).find('[disabled]').find(this).length){if($(this).attr('enable'))return;e.stopPropagation();e.preventDefault();let o=this;o.disabled=!0;$(o).find('input,select,textarea,[contenteditable],button').attr('disabled',!0);setTimeout(()=>{o.disabled=!1;$(o).find('input,select,textarea,[contenteditable],button').attr('disabled',!1)},3000);return!1}})})},_getResizePanelElement:function(gU,gV,gW,gX){return{_tag:'span',_after:function(o){gY();function gY(){setTimeout(()=>{if(gX)return gX(o);let w=o.ownerDocument.defaultView.innerHeight;let gZ=$(o.ownerDocument).find(gV)[0];let r=gZ.getBoundingClientRect();if(r.top>=w)return gY();$(gZ).css({height:`calc(100% - ${r.top+gW}px)`})})}},_attr:{style:function(d,c,o){gU(d);o&&o._viewDef._after(o);return'visibility:hidden;'}}}}};_._setupKeyInput();
